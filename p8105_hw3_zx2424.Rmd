---
title: "p8105_hw3_zx2424"
author: "Zhaoqianyu Xiong"
date: "2022-10-12"
output: github_document
---
## Problem 1
```{r}
library(p8105.datasets)
data("instacart")
```

## Problem 2
```{r}
library(tidyverse)
```

Load, tidy and otherwise wrangle the data. 
```{r}
accel = read_csv("./data/accel_data.csv") %>%
  janitor::clean_names()  %>%
  pivot_longer(
    activity_1:activity_1440,
    names_to = "time_minute",
    names_prefix = "activity_",
    values_to = "activity") %>%
  mutate(weekday_vs_weekend = ifelse(day == "Sunday" | day == "Saturday", "weekend", "weekday")) %>%
  mutate(time_minute = as.integer(time_minute))

```
The resulting dataset includes variables "week", "day_id", "day", "time_minute", "activity", "weekday_vs_weekend". I introduced new variable "time_minute" to show the exact time (count by minute) of the recorded activity. This dataset has `r nrow(accel)` observations.

Total activity for each day
```{r}
accel_day = 
  group_by(accel, day_id) %>%
  summarize(total = sum(activity)) 

accel_day %>%
  ggplot(aes(x = day_id, y = total)) +
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Total activity for each day",
    x = "id of the day",
    y = "total activity"
  )
```
Although there are some extreme points, the trend is that total activity for each day increased for day 1 to day 14, and then went down until day 25. In the last 10 days of observation, it grew again.


```{r}
accel %>%
  ggplot(aes(x = time_minute, y = activity, color = day)) +
  geom_smooth(se = FALSE)
```

## Problem 3
```{r}
library(p8105.datasets)
data("ny_noaa")
library(patchwork)

ny_noaa
```
The size of original dataset is 2595176*7. Key variables include weather station ID, date of observation, precipitation (tens of mm), snowfall (mm), snow depth (mm), maximum temperature (tens of degrees C), and minimum temperature (tens of degree C). A great amount of data is missing for this dataset, reaching `r sum(is.na(ny_noaa))`.

Data cleaning
```{r}
ny_noaa_tidy = 
ny_noaa %>%
  janitor::clean_names() %>%
  separate(col = date, into = c("year", "month", "day"), sep = "-") %>%
  mutate(month = as.integer(month)) %>%
  mutate(year = as.integer(year)) %>%
  mutate(day = as.integer(day)) %>%
  mutate(tmax = as.integer(tmax)/10) %>%
  mutate(tmin = as.integer(tmin)/10)
```

The most commonly observed value for snowfall is 0. Because it does not snow for most days of a year in New York. Therefore, no snowfall is mostly commonly observed.
```{r}
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

common_snow = getmode(pull(ny_noaa, snow))
c(common_snow)
```

```{r}
mean_tmax = 
  ny_noaa_tidy %>%
  filter(month == 1 | month == 7) %>%
  select(id, year, month, tmax) %>%
  group_by(id, year, month) %>%
  summarize(average_tmax = mean(tmax, na.rm = TRUE)) 
```

```{r}
mean_tmax %>%
  ggplot(aes(x = year, y = average_tmax, group = id)) +
  geom_line() +
  facet_grid(~month) +
  labs(
    title = "Average max temperature across the years",
    x = "year",
    y = "average max temperature"
  )
```
Average max temperature in January fluctuated around 0 degree. It firstly increased from 1980 to 1990, then went down until 1995. After that, the temperature fluctuates up and down in a five-year cycle.
Comparing to that in January, the average max temperature change in July is smaller, almost all are around 25 to 30 degree C. 
There are some outliers in both average max temperature in January and July. For example, the temperature station whose id is USC00308962 reported the average max temperature at 14 degree C in July on 1988, while other stations at the same time reported the average max temperature over 20 degree C.

```{r}
ny_noaa_tidy %>%
  select(tmax, tmin) %>%
  pivot_longer(
    tmax:tmin,
    names_to = "observation",
    values_to = "temperature") %>%
  ggplot(aes(x = temperature, fill = observation)) +
  geom_density(alpha = .5) +
  viridis::scale_fill_viridis(discrete = TRUE) +
  labs(title = "tmax vs tmin")

``` 

```{r}
ny_noaa_tidy %>%
  select(year, snow) %>%
  filter(snow > 0 & snow < 100) %>%
  group_by(year) %>%
  ggplot(aes(x = snow, group = year)) +
  geom_density(alpha = .5)
```
